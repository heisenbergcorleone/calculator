<!DOCTYPE html>
<html>
    <head></head>
    <body>
      <div>
       <output id="display">Calculator 1.0</output> 
      </div>
      <br>
      <div> 
      <input type="text" id="nums">
      </div>
    <br>
      <div>
        <output id="history"> History:<br> </output>
      </div>

    <script>

var elInput= document.getElementById("nums");

var check = 0;
var mechArray = [0,"+",""];
var numberArray = ["1","2","3","4","5","6","7","8","9","0"];
var symbolArray = ["+","-","/","*"];
var result;
var alpha = ["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"];
var once = false;
var elOutput = document.getElementById("display");
var elHistory = document.getElementById("history");
var checkLastDecimal = 0;

elInput.addEventListener("keyup", function(e){
  
  var lastValue = elInput.value.charAt(elInput.value.length - 1);
  
  alpha.some(function(e){
    if(lastValue === e) {

      alert("Enter digits!")
      elInput.value = elInput.value.slice(0, -1);
    }
  })

  numberArray.some(function(no){
    if(e.key === no){
      mechArray[2] = elInput.value; 
      elHistory.value += e.key;
      check = 0;
    }
    
  });

  if(e.keyCode === 8) {
    elHistory.value = elHistory.value.slice(0, -1);
    if(elInput.value == "") {
      mechArray[2] = "";
      check = 1;
    } else {
      mechArray[2] = elInput.value;
    }
  };


  symbolArray.some(function(symb) {

    if(e.key === symb) {
      
      if(mechArray[2] == "") {
        mechArray[1] = e.key;
        elInput.value = "";
        elHistory.value += e.key;

        if(check == 1) {
        elHistory.value = elHistory.value.slice(0, elHistory.value.length - 2) + elHistory.value.slice(elHistory.value.length-1);
        }
        
      }

      if (mechArray[2] != ""){

        fixDecimal();
        console.log(result)
        mechArray[0] = result;
        mechArray[1] = e.key;
        mechArray[2] = "";
        elInput.value = "";
        elHistory.value += e.key;
        once = false;
        checkLastDecimal = 0;
      }
      
      check = 1;
    };
  });


  if(e.keyCode === 13) {
    if (mechArray[2] == "") {
      mechArray[1] = "=";
      elInput.value = "";
      elHistory.value += "=";

      if(check == 1) {
        elHistory.value = elHistory.value.slice(0, elHistory.value.length - 2) + elHistory.value.slice(elHistory.value.length-1);
      }

    } else if (mechArray[2] != ""){
      
      fixDecimal();
      console.log(result)
      mechArray[0] = result;
      mechArray[1] = "=";
      mechArray[2] = "";
      elInput.value="";
      elHistory.value += "=";
      once = false;
      checkLastDecimal = 0;
    }
    check = 1;
  };

  if(e.keyCode === 110) {
    checkLastDecimal += 1;
    if(once == false) {
    elHistory.value += ".";
    once = true;
    }
    if(checkLastDecimal > 1) {
    alert("Do not enter the decimal twice!")
    elInput.value = elInput.value.slice(0, -1);
    }
}

  result != undefined ? elOutput.value = result : elOutput.value;
  console.log(mechArray)

})



function fixDecimal () {
    var x = mechArray[0].toString();
    var y =  mechArray[2].toString();

    var store = 0;
    var decX = 0;
    var decY = 0;

    if(x.indexOf(".") != -1) {
      decX = x.length - 1 - x.indexOf(".");
    }
    if(y.indexOf(".") != -1) {
      decY = y.length - 1 - y.indexOf(".");
    }
    decX >= decY ? store = decX : store = decY;
    calculate(store);
}


function calculate(store) {
    
    if(mechArray[1] === "+") {
      result = (parseFloat(mechArray[0])+parseFloat(mechArray[2])).toFixed(store); 
    }
  	else if (mechArray[1] === "-") {
      result = (parseFloat(mechArray[0])-parseFloat(mechArray[2])).toFixed(store);
    }
  	else if (mechArray[1] === "/") {
      result = (parseFloat(mechArray[0])/parseFloat(mechArray[2]));
    }
  	else if (mechArray[1] === "*") {
      result = (parseFloat(mechArray[0])*parseFloat(mechArray[2]));
    }

};




</script>    
    </body>
</html>